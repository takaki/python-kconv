PYTHON_VER = @pythonver@

OBJS = array.o inputer.o outputer.o checker.o kconv.o crl.o
KOBJS = array.o inputer.o outputer.o checker.o kstring.o crl.o
OJBS += $(LIBOBJS)
KOBJS += $(LIBOBJS)
# DFILES = $(patsubst %.o, %.d, $(OBJS))
# DFILES += $(patsubst %.o, %.d, $(KOBJS))
DTARGET = kconv@SO@
KDTARGET = kstring@SO@
PDIR = ../
CFLAGS = -O3 $(CPPFLAGS) -I $(PYTHON_H) @DEFS@ -I $(PDIR) \
			-DKCONV_VERSION="\"$(KCONV_VERSION)\"" \
			-DKSTRING_VERSION="\"$(KSTRING_VERSION)\"" \
			-DSHARED_PREFIX="\"$(SO)\""

LIBS = @LIBS@

CC = @CC@
LDSHARED=@LDSHARED@
RM = @RM@
LD = @LD@
CP = @CP@
MKDIR = @MD@

all: $(DTARGET) $(KDTARGET)
	$(CP) -f $(DTARGET) $(PDIR)
	$(CP) -f $(KDTARGET) $(PDIR)

compile:$(OBJS) $(KOBJS)

# depend: $(DFILES)

clean:
	$(RM) -f $(DTARGET)
	$(RM) -f $(OBJS)
	$(RM) -f $(DFILES)
	$(RM) -f $(KDTARGET)
	$(RM) -f $(KOBJS)
	$(RM) -f *.pyc
	$(RM) -f *~

distclean: clean
	$(RM) -f config.*
	$(RM) -f configure.h
	$(RM) -f Makefile

$(DTARGET):$(OBJS)
	$(LDSHARED) -o $(DTARGET) $(OBJS) $(LIBS)

$(KDTARGET):$(KOBJS)
	$(LDSHARED) -o $(KDTARGET) $(KOBJS) $(LIBS)

%.o:%.cc
	$(CC) $(CFLAGS) -o $@ -c $<

%.o:%.cpp
	$(CC) $(CFLAGS) -o $@ -c $<

%.d:%.cpp
	$(CC) $(CFLAGS) -M -o $@ -c $<

# include $(DFILES)
